<!-- sections/product-template.liquid -->
<div class="product-container">
  <div class="product-layout">
    <!-- Left Side - Image Gallery -->
    <div class="product-images" id="imageGallery">
      <div class="image-scroll-container">
        {% if product.featured_image %}
          <div class="product-image-wrapper">
            <img src="{{ product.featured_image | img_url: 'master' }}" alt="{{ product.featured_image.alt | escape }}">
          </div>
        {% endif %}
        
        {% for image in product.images offset: 1 %}
          <div class="product-image-wrapper">
            <img src="{{ image | img_url: 'master' }}" alt="{{ image.alt | escape }}">
          </div>
        {% endfor %}
      </div>
      
      <!-- Thumbnail Navigation -->
      <div class="thumbnail-nav">
        {% for image in product.images %}
          <div class="thumbnail {% if forloop.first %}active{% endif %}" data-index="{{ forloop.index0 }}">
            <img src="{{ image | img_url: '100x100' }}" alt="{{ image.alt | escape }}">
          </div>
        {% endfor %}
      </div>
    </div>
    <div class="product-info" id="productInfo">
      <div class="product-info-sticky">
        {% if product.tags contains 'coming-soon' %}
          <span class="badge badge-coming-soon">COMING SOON</span>
        {% endif %}
        
        {% if product.tags contains 'sold-out' %}
          <span class="badge badge-sold-out">RASPRODATO</span>
        {% endif %}

        <h1 class="product-title">{{ product.title }}</h1>
        
        <div class="product-price">
          <span class="price">{{ product.price | money }}</span>
        </div>

        <!-- Color Selection -->
        {% if product.variants.size > 1 %}
          <div class="product-options">
            <label>Select a Color</label>
            <div class="color-swatches">
              {% for variant in product.variants %}
                <div class="color-swatch">
                  <input type="radio" name="variant" id="variant-{{ variant.id }}" value="{{ variant.id }}" {% if forloop.first %}checked{% endif %}>
                  <label for="variant-{{ variant.id }}">{{ variant.title }}</label>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <!-- Wishlist Button -->
        <button class="wishlist-btn">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M10 17.5L8.825 16.45C4.5 12.525 1.66667 9.975 1.66667 6.875C1.66667 4.325 3.65833 2.33333 6.20833 2.33333C7.65 2.33333 9.03333 3.025 10 4.08333C10.9667 3.025 12.35 2.33333 13.7917 2.33333C16.3417 2.33333 18.3333 4.325 18.3333 6.875C18.3333 9.975 15.5 12.525 11.175 16.45L10 17.5Z" stroke="currentColor" stroke-width="1.5"/>
          </svg>
          Dodaj na listu ≈æelja
        </button>

        <!-- Add to Cart Button -->
        <button class="add-to-cart-btn" id="addToCart">
          DODAJ U KORPU
        </button>

        <!-- Product Description -->
        <div class="product-description">
          {{ product.description }}
        </div>

        <!-- Material Composition -->
        {% if product.metafields.custom.composition %}
          <div class="product-composition">
            <p><strong>Sirovinski sastav:</strong></p>
            <p>{{ product.metafields.custom.composition }}</p>
          </div>
        {% endif %}

        <!-- Care Instructions -->
        <div class="care-instructions">
          <h3>Naƒçin odr≈æavanja:</h3>
          
          <div class="care-item">
            <span class="care-icon">30¬∞C</span>
            <div>
              <strong>30¬∞C ‚Äì naopako okrenuta</strong>
              <p>Prati na 30¬∞C, blagi program za osetljiv ve≈°. Odevni predmet obavezno okrenuti naopako da ≈°tampa ostane za≈°tiƒáena. Koristiti blagi deterd≈æent (bez omek≈°ivaƒça, bez jakih hemikalija). Ne koristiti omek≈°ivaƒç. Omek≈°ivaƒç  razgraƒëuje elastan i mo≈æe da uni≈°ti aplikaciju/print.</p>
            </div>
          </div>

          <div class="care-item">
            <span class="care-icon warning">‚ö†</span>
            <div>
              <strong>Bez izbeljivaƒça</strong>
              <p>Ne koristiti izbeljivaƒç. Hlor i sredstva za izbeljivanje uni≈°tavaju i vlakna i ≈°tampu.</p>
            </div>
          </div>

          <div class="care-item">
            <span class="care-icon">üî•</span>
            <div>
              <strong>Su≈°iti prirodno</strong>
              <p>Su≈°iti prirodno ili na ni≈æoj temperaturi ma≈°ine za su≈°enje ve≈°a. Ne su≈°iti na direktnom suncu i izvora toplote. Ne su≈°iti u ma≈°ini (≈°tampa i elastan se raƒëuje ili skuplja). Uvek prirodno su≈°enje.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.product-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
}

.product-layout {
  display: flex;
  gap: 60px;
  position: relative;
}

.product-images {
  flex: 1;
  max-width: 50%;
  position: relative;
}

.image-scroll-container {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.product-image-wrapper {
  width: 100%;
  aspect-ratio: 3/4;
  overflow: hidden;
  background: #f5f5f5;
}

.product-image-wrapper img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.thumbnail-nav {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  position: sticky;
  top: 20px;
  background: white;
  padding: 10px 0;
  z-index: 10;
}

.thumbnail {
  width: 60px;
  height: 80px;
  cursor: pointer;
  border: 2px solid transparent;
  overflow: hidden;
}

.thumbnail.active {
  border-color: #333;
}

.thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.product-info {
  flex: 1;
  max-width: 45%;
}

.product-info-sticky {
  position: sticky;
  top: 20px;
}

.badge {
  display: inline-block;
  padding: 6px 12px;
  font-size: 12px;
  font-weight: 600;
  border-radius: 4px;
  margin-bottom: 10px;
}

.badge-coming-soon {
  background: #FFB6C1;
  color: white;
}

.badge-sold-out {
  background: #888;
  color: white;
}

.product-title {
  font-size: 32px;
  font-weight: 300;
  color: #FFB6C1;
  margin: 10px 0;
}

.product-price {
  font-size: 24px;
  margin: 20px 0;
}

.product-options {
  margin: 30px 0;
}

.product-options label {
  display: block;
  font-size: 14px;
  color: #999;
  margin-bottom: 10px;
}

.color-swatches {
  display: flex;
  gap: 10px;
}

.color-swatch input {
  display: none;
}

.color-swatch label {
  padding: 8px 16px;
  border: 1px solid #ddd;
  border-radius: 20px;
  cursor: pointer;
  font-size: 14px;
}

.color-swatch input:checked + label {
  background: #333;
  color: white;
  border-color: #333;
}

.wishlist-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  background: white;
  border: 1px solid #FFB6C1;
  color: #FFB6C1;
  padding: 12px 24px;
  border-radius: 25px;
  cursor: pointer;
  font-size: 14px;
  margin: 20px 0;
  width: 100%;
  justify-content: center;
}

.add-to-cart-btn {
  width: 100%;
  padding: 16px;
  background: linear-gradient(to right, #FFB6C1, #FFC0CB);
  color: white;
  border: none;
  border-radius: 30px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  margin: 20px 0;
}

.product-description {
  line-height: 1.8;
  color: #666;
  margin: 30px 0;
}

.product-composition {
  margin: 20px 0;
  padding: 15px;
  background: #f9f9f9;
  border-radius: 8px;
}

.care-instructions {
  margin-top: 30px;
}

.care-instructions h3 {
  font-size: 16px;
  margin-bottom: 20px;
}

.care-item {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
  padding: 15px;
  background: #f9f9f9;
  border-radius: 8px;
}

.care-icon {
  min-width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: white;
  border-radius: 8px;
  font-weight: bold;
}

.care-icon.warning {
  color: #ff6b6b;
}

.care-item strong {
  display: block;
  margin-bottom: 5px;
}

.care-item p {
  font-size: 13px;
  color: #666;
  line-height: 1.6;
}

@media (max-width: 768px) {
  .product-layout {
    flex-direction: column;
  }
  
  .product-images,
  .product-info {
    max-width: 100%;
  }
  
  .product-info-sticky {
    position: relative;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const imageGallery = document.getElementById('imageGallery');
  const productInfo = document.getElementById('productInfo');
  const imageContainer = imageGallery.querySelector('.image-scroll-container');
  const images = imageContainer.querySelectorAll('.product-image-wrapper');
  const thumbnails = document.querySelectorAll('.thumbnail');
  
  let isImageScrollComplete = false;
  let lastScrollTop = 0;

  // Handle scroll behavior
  function handleScroll() {
    const galleryRect = imageGallery.getBoundingClientRect();
    const containerRect = imageContainer.getBoundingClientRect();
    const lastImage = images[images.length - 1];
    const lastImageRect = lastImage.getBoundingClientRect();
    
    // Check if last image is visible
    if (lastImageRect.bottom <= window.innerHeight) {
      isImageScrollComplete = true;
      document.body.style.overflow = 'auto';
    } else {
      if (window.scrollY === 0) {
        isImageScrollComplete = false;
      }
    }

    // Update active thumbnail based on scroll position
    images.forEach((img, index) => {
      const rect = img.getBoundingClientRect();
      if (rect.top >= 0 && rect.top < window.innerHeight / 2) {
        thumbnails.forEach(t => t.classList.remove('active'));
        thumbnails[index].classList.add('active');
      }
    });
  }

  // Thumbnail click handler
  thumbnails.forEach((thumb, index) => {
    thumb.addEventListener('click', function() {
      images[index].scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
  });

  // Add to cart functionality
  const addToCartBtn = document.getElementById('addToCart');
  addToCartBtn.addEventListener('click', function() {
    const selectedVariant = document.querySelector('input[name="variant"]:checked');
    const variantId = selectedVariant ? selectedVariant.value : {{ product.variants.first.id }};
    
    fetch('/cart/add.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        id: variantId,
        quantity: 1
      })
    })
    .then(response => response.json())
    .then(data => {
      alert('Proizvod je dodat u korpu!');
      // You can add your own cart drawer/modal logic here
    })
    .catch(error => {
      console.error('Error:', error);
    });
  });

  window.addEventListener('scroll', handleScroll);
  handleScroll();
});
</script>
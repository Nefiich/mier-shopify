{% comment %}
  Collection Grid Section
  Displays products from a selected collection in a grid layout
{% endcomment %}

{%- liquid
  assign collection = collections[section.settings.collection]
  assign products_to_show = section.settings.products_to_show
  assign title = section.settings.title
-%}

<div class="collection-grid-section" data-section-id="{{ section.id }}">
  <div class="page-width">
    {% if collection != blank and collection.products.size > 0 %}
      <div class="collection-grid">
        {% comment %} Title as first grid item {% endcomment %}
        {% if title != blank %}
          <div class="collection-grid__title-card">
            <h2 class="collection-grid__title">{{ title }}</h2>
          </div>
        {% endif %}

        {% for product in collection.products limit: products_to_show %}
          <div class="product-card">
            <div class="product-card__image-wrapper">
              <a href="{{ product.url }}" class="product-card__link">
                {% if product.featured_image %}
                  <img 
                    src="{{ product.featured_image | img_url: '600x' }}"
                    alt="{{ product.featured_image.alt | escape }}"
                    class="product-card__image"
                    loading="lazy"
                  >
                {% else %}
                  {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                {% endif %}
              </a>

              {% comment %} Coming Soon Badge {% endcomment %}
              {% if product.tags contains 'coming-soon' or product.available == false %}
                <span class="product-card__badge">COMING SOON</span>
              {% endif %}

              {% comment %} Wishlist Button {% endcomment %}
              <button class="product-card__wishlist" aria-label="Add to wishlist">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10 17.5L8.825 16.45C4.4 12.46 1.5 9.85 1.5 6.75C1.5 4.14 3.515 2.125 6.125 2.125C7.605 2.125 9.025 2.805 10 3.89C10.975 2.805 12.395 2.125 13.875 2.125C16.485 2.125 18.5 4.14 18.5 6.75C18.5 9.85 15.6 12.46 11.175 16.45L10 17.5Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
              </button>
            </div>

            <div class="product-card__info">
              <h3 class="product-card__title">
                <a href="{{ product.url }}">{{ product.title }}</a>
              </h3>
              
              <div class="product-card__price">
                {% if product.compare_at_price > product.price %}
                  <span class="price--sale">{{ product.price | money }}</span>
                  <span class="price--compare">{{ product.compare_at_price | money }}</span>
                {% else %}
                  <span class="price">{{ product.price | money }}</span>
                {% endif %}
              </div>

              {% comment %} Color Swatches {% endcomment %}
              {% if product.variants.size > 1 %}
                <div class="product-card__swatches">
                  {% for variant in product.variants limit: 5 %}
                    {% if variant.option1 contains 'color' or variant.option1 or forloop.index <= 5 %}
                      <button 
                        class="swatch{% if forloop.first %} swatch--active{% endif %}"
                        aria-label="{{ variant.title }}"
                        data-variant-id="{{ variant.id }}"
                      >
                        {% if variant.featured_image %}
                          <img src="{{ variant.featured_image | img_url: '50x' }}" alt="{{ variant.title }}">
                        {% endif %}
                      </button>
                    {% endif %}
                  {% endfor %}
                  
                  {% if product.variants.size > 5 %}
                    <button class="swatch swatch--more" aria-label="More colors">
                      <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                        <path d="M6 1V11M1 6H11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                      </svg>
                    </button>
                  {% endif %}
                </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="collection-grid__empty">
        <p>No products found. Please select a collection in the theme editor.</p>
      </div>
    {% endif %}
  </div>
</div>

<style>
.collection-grid-section {
  padding: 0;
}

.page-width {
  max-width: 100%;
  margin: 0 auto;
  padding: 0;
}

.collection-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 0;
}

.collection-grid__title-card {
  position: relative;
  background: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  aspect-ratio: 2/3;
}

.collection-grid__title {
  font-size: 32px;
  font-weight: 300;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: #f5a5b8;
  margin: 0;
  padding: 20px;
  text-align: center;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

.product-card {
  position: relative;
  background: #fff;
}

.product-card__image-wrapper {
  position: relative;
  overflow: hidden;
  background: #f5f5f5;
  aspect-ratio: 2/3;
  margin-bottom: 0;
}

.product-card__link {
  display: block;
  width: 100%;
  height: 100%;
}

.product-card__image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.product-card:hover .product-card__image {
  transform: scale(1.05);
}

.product-card__badge {
  position: absolute;
  top: 15px;
  right: 15px;
  background: #f5a5b8;
  color: #fff;
  padding: 6px 16px;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
  z-index: 2;
}

.product-card__wishlist {
  position: absolute;
  top: 15px;
  left: 15px;
  width: 36px;
  height: 36px;
  background: #fff;
  border: none;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
  z-index: 2;
}

.product-card__wishlist:hover {
  background: #f5f5f5;
}

.product-card__wishlist svg {
  width: 20px;
  height: 20px;
  color: #666;
}

.product-card__info {
  padding: 15px;
  background: #fff;
}

.product-card__title {
  font-size: 14px;
  font-weight: 400;
  margin-bottom: 8px;
  color: #333;
}

.product-card__title a {
  text-decoration: none;
  color: inherit;
  transition: color 0.2s ease;
}

.product-card__title a:hover {
  color: #f5a5b8;
}

.product-card__price {
  font-size: 14px;
  margin-bottom: 12px;
  color: #666;
}

.price--sale {
  color: #e63946;
  margin-right: 8px;
}

.price--compare {
  text-decoration: line-through;
  color: #999;
}

.product-card__swatches {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.swatch {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  border: 2px solid transparent;
  padding: 0;
  background: #e5e5e5;
  cursor: pointer;
  transition: all 0.2s ease;
  overflow: hidden;
}

.swatch img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.swatch--active,
.swatch:hover {
  border-color: #333;
}

.swatch--more {
  background: #fff;
  border: 1px solid #ddd;
  display: flex;
  align-items: center;
  justify-content: center;
}

.swatch--more svg {
  color: #666;
}

.collection-grid__empty {
  text-align: center;
  padding: 60px 20px;
  color: #666;
}

@media (max-width: 768px) {
  .collection-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 0;
  }

  .collection-grid__title {
    font-size: 24px;
  }
}

@media (max-width: 480px) {
  .collection-grid {
    grid-template-columns: 1fr;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Wishlist functionality
  document.querySelectorAll('.product-card__wishlist').forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      this.classList.toggle('active');
      // Add your wishlist logic here
    });
  });

  // Swatch functionality
  document.querySelectorAll('.swatch').forEach(swatch => {
    swatch.addEventListener('click', function(e) {
      e.preventDefault();
      const card = this.closest('.product-card');
      card.querySelectorAll('.swatch').forEach(s => s.classList.remove('swatch--active'));
      this.classList.add('swatch--active');
      
      // Add variant image switching logic here if needed
      const variantId = this.dataset.variantId;
    });
  });
});
</script>

{% schema %}
{
  "name": "Collection Grid",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "SPORT CLUB"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Products to show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 6
    }
  ],
  "presets": [
    {
      "name": "Collection Grid",
      "category": "Collection"
    }
  ]
}
{% endschema %}